<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="835px" preserveAspectRatio="none" style="width:2171px;height:835px;" version="1.1" viewBox="0 0 2171 835" width="2171px" zoomAndPan="magnify"><defs><filter height="300%" id="finw0yy8soyc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="21.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="99" y="52.2969"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="219.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="330" y="73.4297"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="480.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="930.5" y="293.3594"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1142" y="322.4922"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="82.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1286" y="380.7578"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="87.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1444" y="576.5547"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="59.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1779.5" y="693.0859"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2014.5" y="722.2188"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="601.5234" style="stroke: #000000; stroke-width: 2.0;" width="1970.5" x="190" y="172.6953"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="512.125" style="stroke: #000000; stroke-width: 2.0;" width="1950.5" x="200" y="255.0938"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="364.4609" style="stroke: #000000; stroke-width: 2.0;" width="1329" x="811.5" y="395.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="104" x2="104" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="335" x2="335" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="715.5" x2="715.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="935.5" x2="935.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1146.5" x2="1146.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1290.5" x2="1290.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1448.5" x2="1448.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1647.5" x2="1647.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1784.5" x2="1784.5" y1="42.2969" y2="791.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2019.5" x2="2019.5" y1="42.2969" y2="791.2188"/><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="8" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="15" y="26.9951">ConsumerWorker.Worker</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="8" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="15" y="810.2139">ConsumerWorker.Worker</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="246" x="210" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="232" x="217" y="26.9951">KafkaMessageConsumerManager</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="246" x="210" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="232" x="217" y="810.2139">KafkaMessageConsumerManager</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="620.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="627.5" y="26.9951">ServiceProvider`Manager</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="620.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="627.5" y="810.2139">ServiceProvider`Manager</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="224" x="821.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="210" x="828.5" y="26.9951">KafkaTopicMessageConsumer</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="224" x="821.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="210" x="828.5" y="810.2139">KafkaTopicMessageConsumer</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1059.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1066.5" y="26.9951">KafkaConsumerBuilder</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1059.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1066.5" y="810.2139">KafkaConsumerBuilder</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1244.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1251.5" y="26.9951">IConsumer</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1244.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1251.5" y="810.2139">IConsumer</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="1347.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="185" x="1354.5" y="26.9951">ServiceProvider`Consumer</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="1347.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="185" x="1354.5" y="810.2139">ServiceProvider`Consumer</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1560.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1567.5" y="26.9951">ServiceProvider`Scope</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1560.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1567.5" y="810.2139">ServiceProvider`Scope</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="1745.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="1752.5" y="26.9951">Mediator</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="1745.5" y="790.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="1752.5" y="810.2139">Mediator</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="214" x="1912.5" y="3"/><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="214" x="1908.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="200" x="1915.5" y="26.9951">MessageNotificationHandlers</text><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="214" x="1912.5" y="790.2188"/><rect fill="#FEFECE" filter="url(#finw0yy8soyc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="214" x="1908.5" y="794.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="200" x="1915.5" y="814.2139">MessageNotificationHandlers</text><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="21.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="99" y="52.2969"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="219.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="330" y="73.4297"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="480.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="930.5" y="293.3594"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1142" y="322.4922"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="82.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1286" y="380.7578"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="87.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1444" y="576.5547"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="59.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1779.5" y="693.0859"/><rect fill="#FFFFFF" filter="url(#finw0yy8soyc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2014.5" y="722.2188"/><polygon fill="#A80036" points="318,69.4297,328,73.4297,318,77.4297,322,73.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="324" y1="73.4297" y2="73.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="111" y="68.3638">StartConsumers(ct)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="340" x2="382" y1="102.5625" y2="102.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="382" y1="102.5625" y2="115.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="341" x2="382" y1="115.5625" y2="115.5625"/><polygon fill="#A80036" points="351,111.5625,341,115.5625,351,119.5625,347,115.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="347" y="97.4966">find all messages with notification handlers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="340" x2="382" y1="144.6953" y2="144.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="382" y1="144.6953" y2="157.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="341" x2="382" y1="157.6953" y2="157.6953"/><polygon fill="#A80036" points="351,153.6953,341,157.6953,351,161.6953,347,157.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="347" y="139.6294">find the topics for those messages</text><path d="M190,172.6953 L267,172.6953 L267,179.6953 L257,189.6953 L190,189.6953 L190,172.6953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="601.5234" style="stroke: #000000; stroke-width: 2.0;" width="1970.5" x="190" y="172.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="205" y="185.7622">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247" x="282" y="184.9058">[each topic with notification handlers]</text><polygon fill="#A80036" points="704,206.9609,714,210.9609,704,214.9609,708,210.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="340" x2="710" y1="210.9609" y2="210.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="347" y="205.895">GetRequiredService&lt;IKafkaTopicMessageConsumer&gt;()</text><polygon fill="#A80036" points="351,236.0938,341,240.0938,351,244.0938,347,240.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="345" x2="715" y1="240.0938" y2="240.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="357" y="235.0278">kafkaTopicMessageConsumer</text><path d="M200,255.0938 L329,255.0938 L329,262.0938 L319,272.0938 L200,272.0938 L200,255.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="512.125" style="stroke: #000000; stroke-width: 2.0;" width="1950.5" x="200" y="255.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="215" y="268.1606">new thread</text><polygon fill="#A80036" points="918.5,289.3594,928.5,293.3594,918.5,297.3594,922.5,293.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335" x2="924.5" y1="293.3594" y2="293.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="342" y="288.2935">StartConsuming(topic, ct)</text><polygon fill="#A80036" points="1130,318.4922,1140,322.4922,1130,326.4922,1134,322.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="1136" y1="322.4922" y2="322.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="947.5" y="317.4263">Build()</text><polygon fill="#A80036" points="951.5,347.625,941.5,351.625,951.5,355.625,947.5,351.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="945.5" x2="1146" y1="351.625" y2="351.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="957.5" y="346.5591">consumer</text><polygon fill="#A80036" points="1274,376.7578,1284,380.7578,1274,384.7578,1278,380.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="1280" y1="380.7578" y2="380.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="947.5" y="375.6919">Subscribe(topic)</text><path d="M811.5,395.7578 L888.5,395.7578 L888.5,402.7578 L878.5,412.7578 L811.5,412.7578 L811.5,395.7578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="364.4609" style="stroke: #000000; stroke-width: 2.0;" width="1329" x="811.5" y="395.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="826.5" y="408.8247">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359" x="903.5" y="407.9683">[while no cancellation requested on cancellationToken]</text><polygon fill="#A80036" points="1274,430.0234,1284,434.0234,1274,438.0234,1278,434.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="1280" y1="434.0234" y2="434.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="947.5" y="428.9575">Consume(ct)</text><polygon fill="#A80036" points="951.5,459.1563,941.5,463.1563,951.5,467.1563,947.5,463.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="945.5" x2="1290" y1="463.1563" y2="463.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="957.5" y="458.0903">consumeResult</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="982.5" y1="492.2891" y2="492.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="982.5" x2="982.5" y1="492.2891" y2="505.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="941.5" x2="982.5" y1="505.2891" y2="505.2891"/><polygon fill="#A80036" points="951.5,501.2891,941.5,505.2891,951.5,509.2891,947.5,505.2891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="947.5" y="487.2231">determine message type</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="982.5" y1="534.4219" y2="534.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="982.5" x2="982.5" y1="534.4219" y2="547.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="941.5" x2="982.5" y1="547.4219" y2="547.4219"/><polygon fill="#A80036" points="951.5,543.4219,941.5,547.4219,951.5,551.4219,947.5,547.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="947.5" y="529.356">build MessageNotification</text><polygon fill="#A80036" points="1432,572.5547,1442,576.5547,1432,580.5547,1436,576.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="1438" y1="576.5547" y2="576.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="947.5" y="571.4888">CreateScope()</text><polygon fill="#A80036" points="951.5,601.6875,941.5,605.6875,951.5,609.6875,947.5,605.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="945.5" x2="1443" y1="605.6875" y2="605.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="957.5" y="600.6216">scope</text><polygon fill="#A80036" points="1636,630.8203,1646,634.8203,1636,638.8203,1640,634.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="1642" y1="634.8203" y2="634.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="947.5" y="629.7544">GetRequiredService&lt;IMediator&gt;</text><polygon fill="#A80036" points="951.5,659.9531,941.5,663.9531,951.5,667.9531,947.5,663.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="945.5" x2="1647" y1="663.9531" y2="663.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="957.5" y="658.8872">mediator</text><polygon fill="#A80036" points="1767.5,689.0859,1777.5,693.0859,1767.5,697.0859,1771.5,693.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940.5" x2="1773.5" y1="693.0859" y2="693.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="947.5" y="688.02">Publish(messageNotification, ct)</text><polygon fill="#A80036" points="2002.5,718.2188,2012.5,722.2188,2002.5,726.2188,2006.5,722.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1789.5" x2="2008.5" y1="722.2188" y2="722.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="1796.5" y="717.1528">Handle(messageNotification, ct)</text><!--MD5=[32bddde4d6bdcba4a64a359be6b528c3]
@startuml
    participant ConsumerWorker.Worker
    participant KafkaMessageConsumerManager
    participant "ServiceProvider`Manager"
    participant KafkaTopicMessageConsumer
    participant KafkaConsumerBuilder
    participant IConsumer
    participant "ServiceProvider`Consumer"
    participant "ServiceProvider`Scope"
    participant Mediator
    collections MessageNotificationHandlers

    activate ConsumerWorker.Worker
    ConsumerWorker.Worker -> KafkaMessageConsumerManager : StartConsumers(ct)
    deactivate ConsumerWorker.Worker

    activate KafkaMessageConsumerManager
    KafkaMessageConsumerManager -> KafkaMessageConsumerManager : find all messages with notification handlers
    KafkaMessageConsumerManager -> KafkaMessageConsumerManager : find the topics for those messages
    loop each topic with notification handlers
        KafkaMessageConsumerManager -> "ServiceProvider`Manager" : GetRequiredService<IKafkaTopicMessageConsumer>()
        KafkaMessageConsumerManager <- - "ServiceProvider`Manager" : kafkaTopicMessageConsumer
        group new thread
            KafkaMessageConsumerManager -> KafkaTopicMessageConsumer : StartConsuming(topic, ct)
            deactivate KafkaMessageConsumerManager

            activate KafkaTopicMessageConsumer
            KafkaTopicMessageConsumer -> KafkaConsumerBuilder : Build()

            activate KafkaConsumerBuilder
            KafkaTopicMessageConsumer <- - KafkaConsumerBuilder : consumer
            deactivate KafkaConsumerBuilder

            KafkaTopicMessageConsumer -> IConsumer : Subscribe(topic)
            activate IConsumer
            loop while no cancellation requested on cancellationToken
                KafkaTopicMessageConsumer -> IConsumer : Consume(ct)
                KafkaTopicMessageConsumer <- - IConsumer : consumeResult
                deactivate IConsumer

                KafkaTopicMessageConsumer -> KafkaTopicMessageConsumer : determine message type
                KafkaTopicMessageConsumer -> KafkaTopicMessageConsumer : build MessageNotification

                KafkaTopicMessageConsumer -> "ServiceProvider`Consumer" : CreateScope()
                activate "ServiceProvider`Consumer"
                KafkaTopicMessageConsumer <- - "ServiceProvider`Consumer" : scope
                KafkaTopicMessageConsumer -> "ServiceProvider`Scope" : GetRequiredService<IMediator>
                KafkaTopicMessageConsumer <- - "ServiceProvider`Scope" : mediator
                deactivate "ServiceProvider`Consumer"

                KafkaTopicMessageConsumer -> Mediator : Publish(messageNotification, ct)
                activate Mediator
                Mediator -> MessageNotificationHandlers : Handle(messageNotification, ct)
                activate MessageNotificationHandlers
                deactivate MessageNotificationHandlers
                deactivate Mediator
            end
        end
        deactivate KafkaTopicMessageConsumer
    end
@enduml

PlantUML version 1.2020.06(Sun Apr 05 12:38:32 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+33
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>